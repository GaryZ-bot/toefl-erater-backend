<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TOEFL E-rater (MVP)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background:#0b1020; color:#eef1ff; }
    .wrap { max-width: 800px; margin: 4rem auto; padding: 2rem; background:#121736; border-radius: 16px; }
    h1 { margin-top: 0; }
    .muted { color:#b7c1ff; opacity:.8; }

    textarea { width: 100%; min-height: 260px; padding: 12px; border-radius: 12px; border: 1px solid #2b2f55; background:#0f1430; color:#eef1ff; font-size: 16px; }
    button { padding: 10px 16px; border: none; border-radius: 12px; background: #5865f2; color: white; font-weight: 600; cursor: pointer; }
    button:hover { filter: brightness(0.9); }

    .card { border: 1px solid #2b2f55; border-radius: 12px; padding: 1rem; margin-top: 1rem; background:#0f1430; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: .5rem 1rem; }
  </style>
</head>
<body>
  <div class="wrap">
  <h1>TOEFL E-rater</h1>
  <p class="muted">Paste your essay and get a 1â€“5 score with quick feedback.</p>
  <textarea id="essay" placeholder="Paste your essay here..."></textarea>
  <div>
    <button id="scoreBtn">Get score</button>
    <span id="status" class="muted"></span>
  </div>
  <div id="result" class="card" style="display:none;"></div>

  <script>
    const btn = document.getElementById('scoreBtn');
    const status = document.getElementById('status');
    const resultEl = document.getElementById('result');

    btn.onclick = async () => {
      const essay = document.getElementById('essay').value.trim();
      if (!essay) { alert('Please paste your essay.'); return; }
      btn.disabled = true; status.textContent = 'Scoring...';

      try {
        const API_BASE = 'https://erater-project.fly.dev';  // your backend endpoint
        const res = await fetch(`${API_BASE}/api/grade`, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ essay })
        });

        const text = await res.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch {
          throw new Error(`Backend returned non-JSON (${res.status}): ${text.slice(0,200)}`);
        }

        if (!res.ok) {
          throw new Error(data?.error || `Request failed: ${res.status}`);
        }

        const dims = ['task_response','organization','language_use','development','mechanics'];
        const items = dims.map(k => `<div>${k.replace('_',' ')}:</div><div><strong>${data[k]}</strong>/5</div>`).join('');
        resultEl.innerHTML = `
          <div class="row">${items}</div>
          <hr/>
          <div>Overall: <strong>${data.overall_score}</strong>/5</div>
          <p class="muted">${data.concise_rationale}</p>
        `;
        resultEl.style.display = 'block';
      } catch (e) {
        alert(e.message);
      } finally {
        btn.disabled = false; status.textContent = '';
      }
    };
  </script>
</div>
</body>
</html>